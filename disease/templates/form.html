{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Disease Prediction</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="{% static 'disease/css/style.css' %}">
  <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/lumen/bootstrap.min.css">
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="{% url 'home' %}">MePredictor Pro</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="{% url 'home' %}">Home</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- Prediction Section -->
<section id="predict" style="position: relative; min-height: 100vh; overflow: hidden;">
  <video autoplay muted loop class="background-video" style="position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-1;">
    <source src="{% static 'media/2.mp4' %}" type="video/mp4">
  </video>

  <div class="overlay d-flex justify-content-center align-items-center" style="position:relative; z-index:1; background-color: rgba(0,0,0,0.6); padding: 60px 20px;">
    <div class="container text-white text-center">
      <h2 class="display-5 fw-bold mb-4">Disease Prediction</h2>

      <!-- Form -->
      <form method="POST" action="{% url 'predict' %}" class="bg-light text-dark p-4 rounded shadow" style="max-width: 900px; margin: auto;">
        {% csrf_token %}
        {% if error %}
          <div class="alert alert-danger" role="alert">
            {{ error }}
          </div>
        {% endif %}
        <div class="row">
          {% for s in symptoms %}
          <div class="col-md-4 mb-2">
            <div class="form-check text-start">
              <input class="form-check-input" type="checkbox" name="symptoms" value="{{ s }}" id="symptom_{{ forloop.counter }}">
              <label class="form-check-label" for="symptom_{{ forloop.counter }}">{{ s|capfirst }}</label>
            </div>
          </div>
          {% endfor %}
        </div>
        <button type="submit" class="btn btn-primary mt-4">Predict</button>
      </form>

      <!-- Prediction Result -->
      {% if top_diseases or predicted_disease %}
      <div id="predict-result" class="bg-white text-dark mt-5 p-5 rounded shadow" style="max-width: 1000px; margin: auto;">
        <h3 class="fw-bold mb-4 text-center">ü©∫ Prediction Result</h3>

        {% if top_diseases %}
        <p class="text-center">Based on your symptoms, you may have:</p>
        <div class="row justify-content-center">
          {% for disease, prob in top_diseases %}
          <div class="col-md-4">
            <div class="card border-primary mb-3 shadow-sm">
              <div class="card-body">
                <h5 class="card-title text-primary text-center">{{ disease }}</h5>
                <p class="card-text text-center">Prediction Confidence: <strong>{{ prob }}%</strong></p>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% elif predicted_disease %}
        <p class="text-center">Possible diseases (rule-based):</p>
        <div class="row justify-content-center">
          <div class="col-md-12">
            <div class="alert alert-warning" role="alert">
              {{ predicted_disease }}
            </div>
          </div>
        </div>
        {% endif %}

        {% if precautions %}
        <h5 class="fw-bold mt-4">Suggested Precautions:</h5>
        <ul class="fs-5 text-start" style="line-height: 2;">
          {% for p in precautions %}
          <li>{{ p }}</li>
          {% endfor %}
        </ul>
        {% endif %}

        <hr class="my-4">
        <p class="fs-6 text-muted text-center">
          ‚ö†Ô∏è This is an AI-based prediction. Please consult a medical professional.
        </p>
      </div>
      {% endif %}

    </div>
  </div>
</section>

{% if scroll_to %}
<script>
  window.addEventListener("DOMContentLoaded", function () {
    const target = document.getElementById("{{ scroll_to }}-result");
    if (target) {
      target.scrollIntoView({ behavior: "smooth" });
    }
  });
</script>
{% endif %}

</body>
</html>
